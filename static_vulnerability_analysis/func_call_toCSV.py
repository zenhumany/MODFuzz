
import angr
import pandas as pd
from important_global_data import *

kernel = angr.Project(kernal_binary, use_sim_procedures=False,
                      auto_load_libs=False)
cfg = kernel.analyses.CFGFast()
call_graph = pd.read_csv(csv_path, names=["func_name", "func_addr",
                                          "call_site_block", "call_target", "call_return_block"])
for i in cfg.kb.functions:
    cur_func = cfg.kb.functions[i]
    for call_site_addr in cur_func.get_call_sites():
        call_graph = call_graph.append({'func_name': cur_func.name,
                                        'func_addr': cur_func.addr,
                                        'call_site_block': call_site_addr,
                                        'call_target': cur_func.get_call_target(call_site_addr),
                                        'call_return_block': cur_func.get_call_return(call_site_addr)},
                                       ignore_index=True)
call_graph.to_csv(csv_path, index=False)
